<script>
    const baseUrl = 'https://admin:NHDlosin23@203.147.59.117:31954/ISAPI/Streaming/channels/2/picture';
    const maxImages = 9;
    let imageHistory = [];

    function addNewImage() {
        const now = new Date();
        const timestamp = now.getTime();
        const timeString = now.toLocaleTimeString();
        const imageUrl = `${baseUrl}?t=${timestamp}`;
        
        imageHistory.unshift({
            url: imageUrl,
            time: timeString
        });
        
        if (imageHistory.length > maxImages) {
            imageHistory.pop();
        }

        updateGrid();
    }

    function updateGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        
        imageHistory.forEach((imageData, index) => {
            const container = document.createElement('div');
            container.className = 'image-container';
            // Direct img tag - sometimes bypasses mixed content for images
            container.innerHTML = `
                <img src="${imageData.url}" alt="CCTV Image ${index + 1}" style="width:100%; height:auto;">
                <div class="timestamp">${imageData.time}</div>
            `;
            grid.appendChild(container);
        });
    }
    function toggleRefresh() {
        if (isRefreshing) {
            clearInterval(refreshInterval);
            document.getElementById('refresh-status').textContent = 'Auto-refresh: OFF';
            isRefreshing = false;
        } else {
            startRefresh();
            document.getElementById('refresh-status').textContent = 'Auto-refresh: ON (every 30s)';
            isRefreshing = true;
        }
    }

    function clearImages() {
        imageHistory = [];
        updateGrid();
        document.getElementById('status').textContent = 'Images cleared. Next refresh will start new sequence.';
    }

    function startRefresh() {
        refreshInterval = setInterval(addNewImage, 30000); // 30 seconds
    }

    // Initial load
    addNewImage();
    startRefresh();
</script>
